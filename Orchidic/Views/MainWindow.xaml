<Window x:Class="Orchidic.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewModels="clr-namespace:Orchidic.ViewModels"
        xmlns:views="clr-namespace:Orchidic.Views"
        xmlns:components="clr-namespace:Orchidic.Views.Components"
        xmlns:reactiveUi="http://reactiveui.net"
        xmlns:utils="clr-namespace:Orchidic.Utils"
        xmlns:system="clr-namespace:System;assembly=System.Runtime"
        xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
        mc:Ignorable="d"
        Width="1200" Height="800"
        MinWidth="900" MinHeight="600"
        WindowStartupLocation="CenterScreen"
        d:DataContext="{d:DesignInstance Type=viewModels:MainWindowViewModel}"
        SnapsToDevicePixels="True"
        WindowStyle="None"
        Background="Transparent"
        Title="{x:Static utils:ProgramConstants.AppName}">

  <Window.Resources>
    <views:MenuWidthConverter x:Key="MenuWidthConverter" />
    <views:BlurCoverSizeConverter x:Key="BlurCoverSizeConverter" />
  </Window.Resources>

  <WindowChrome.WindowChrome>
    <WindowChrome CaptionHeight="50"
                  CornerRadius="0"
                  GlassFrameThickness="0,0,0,1"
                  ResizeBorderThickness="6"
                  UseAeroCaptionButtons="False"
                  NonClientFrameEdges="Bottom" />
  </WindowChrome.WindowChrome>


  <Grid
    Background="{DynamicResource BGBrush}"
    x:Name="RootParent"
    Margin="{Binding WindowState, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource StateToMargin}}">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="Auto" />
      <ColumnDefinition Width="*" />
    </Grid.ColumnDefinitions>

    <!-- blur cover -->
    <Grid Grid.Column="0" ColumnSpan="2" Grid.Row="0" RowSpan="2" ClipToBounds="False">
      <Image
        Stretch="UniformToFill"
        SnapsToDevicePixels="True"
        UseLayoutRounding="True"
        ClipToBounds="False"
        RenderOptions.BitmapScalingMode="LowQuality"
        HorizontalAlignment="Center"
        VerticalAlignment="Center"
        Opacity="{DynamicResource BlurCoverOpacity}">
        <b:Interaction.Behaviors>
          <utils:ImageFadeBehavior Source="{Binding AudioQueueService.CurrentBlurCover}" />
        </b:Interaction.Behaviors>
        <Image.Height>
          <MultiBinding Converter="{StaticResource BlurCoverSizeConverter}">
            <Binding Path="ActualWidth" ElementName="RootParent" />
            <Binding Path="ActualHeight" ElementName="RootParent" />
          </MultiBinding>
        </Image.Height>
        <Image.Width>
          <MultiBinding Converter="{StaticResource BlurCoverSizeConverter}">
            <Binding Path="ActualWidth" ElementName="RootParent" />
            <Binding Path="ActualHeight" ElementName="RootParent" />
          </MultiBinding>
        </Image.Width>
      </Image>
    </Grid>

    <!-- content -->
    <Grid Grid.Row="0" Grid.Column="1" Grid.RowSpan="2">
      <reactiveUi:TransitioningContentControl
        HorizontalContentAlignment="Stretch"
        VerticalContentAlignment="Stretch"
        Content="{Binding CurrentPageViewModel, Converter={StaticResource ViewModelToViewConverter}}"
        Transition="Fade"
        Duration="0:0:0.150" />
    </Grid>


    <!-- title bar -->
    <Grid Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Height="50"
          Background="Transparent">
      <Grid.Style>
        <Style TargetType="Grid">
          <Setter Property="Opacity" Value="0" />
          <Setter Property="Visibility" Value="Collapsed" />

          <Style.Triggers>
            <DataTrigger Binding="{Binding GlobalService.IsZenMode}" Value="False">
              <Setter Property="Opacity" Value="1" />
              <Setter Property="Visibility" Value="Visible" />
              <DataTrigger.EnterActions>
                <BeginStoryboard>
                  <Storyboard>
                    <DoubleAnimation
                      Storyboard.TargetProperty="Opacity"
                      From="0" To="1"
                      Duration="0:0:0.15" />
                  </Storyboard>
                </BeginStoryboard>
              </DataTrigger.EnterActions>
            </DataTrigger>
            
            <DataTrigger Binding="{Binding GlobalService.IsZenMode}" Value="True">
              <Setter Property="Opacity" Value="0" />
              <Setter Property="Visibility" Value="Collapsed" />
              <DataTrigger.EnterActions>
                <BeginStoryboard x:Name="FadeOutStoryboard">
                  <Storyboard>
                    <DoubleAnimation
                      Storyboard.TargetProperty="Opacity"
                      From="1" To="0"
                      Duration="0:0:0.15"
                      FillBehavior="Stop" />
                  </Storyboard>
                </BeginStoryboard>
              </DataTrigger.EnterActions>
            </DataTrigger>

          </Style.Triggers>
        </Style>

      </Grid.Style>
      <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
        <Grid Height="50" Width="30">
          <components:SvgIconButton Width="20" Height="20"
                                    WindowChrome.IsHitTestVisibleInChrome="True"
                                    Size="0.7"
                                    IconBrush="{StaticResource SecondaryBrush}"
                                    IconData="{StaticResource MinWindowIconGeometry}"
                                    HoverBrush="{StaticResource LightSecondaryBrush}"
                                    PressedBrush="{StaticResource DarkSecondaryBrush}"
                                    Command="{Binding MinimizeCommand}"
                                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}">
          </components:SvgIconButton>
        </Grid>

        <Grid Height="50" Width="30">
          <components:SvgIconButton Width="20" Height="20"
                                    Size="0.7"
                                    WindowChrome.IsHitTestVisibleInChrome="True"
                                    IconBrush="{StaticResource SecondaryBrush}"
                                    HoverBrush="{StaticResource LightSecondaryBrush}"
                                    PressedBrush="{StaticResource DarkSecondaryBrush}"
                                    Command="{Binding ToggleMaximizeCommand}"
                                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}">
            <components:SvgIconButton.IconData>
              <MultiBinding Converter="{StaticResource ConditionConverter}">
                <Binding Path="WindowState" RelativeSource="{RelativeSource AncestorType=Window}"
                         Converter="{StaticResource IsWindowStateMaximizedConverter}" />
                <Binding Source="{StaticResource MaxWindowIcon2Geometry}" />
                <Binding Source="{StaticResource MaxWindowIconGeometry}" />
              </MultiBinding>
            </components:SvgIconButton.IconData>
          </components:SvgIconButton>
        </Grid>

        <Grid Height="50" Width="30" Margin="0,0,8,0">
          <components:SvgIconButton Width="20" Height="20"
                                    Size="0.7"
                                    WindowChrome.IsHitTestVisibleInChrome="True"
                                    IconBrush="{StaticResource SecondaryBrush}"
                                    IconData="{StaticResource CloseWindowIconGeometry}"
                                    HoverBrush="{StaticResource DangerHoverBrush}"
                                    PressedBrush="{StaticResource DangerPressedBrush}"
                                    Command="{Binding CloseCommand}"
                                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}">
          </components:SvgIconButton>
        </Grid>
      </StackPanel>
    </Grid>

    <!-- left menu bar -->
    <Grid Grid.Row="0" Grid.Column="0" Grid.RowSpan="2"
          Background="{DynamicResource ContainerBrush}">
      <utils:AnimatedWidthBehavior.AnimatedWidth>
        <MultiBinding Converter="{StaticResource ConditionConverter}">
          <Binding Path="GlobalService.IsZenMode" />
          <Binding>
            <Binding.Source>
              <system:Double>0</system:Double>
            </Binding.Source>
          </Binding>
          <Binding
            Path="ActualWidth"
            RelativeSource="{RelativeSource AncestorType=Window}"
            Converter="{StaticResource MenuWidthConverter}">
          </Binding>
        </MultiBinding>
      </utils:AnimatedWidthBehavior.AnimatedWidth>

      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <!-- title -->
        <Grid Height="100">
          <TextBlock FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center"
                     Foreground="{DynamicResource PrimaryBrush}" FontWeight="Bold"
                     Text="{x:Static utils:ProgramConstants.AppName}" />
        </Grid>

        <!-- menu -->
        <components:SideMenu Grid.Row="1" DataContext="{Binding SideMenuViewModel}"></components:SideMenu>
      </Grid>
    </Grid>
  </Grid>
</Window>