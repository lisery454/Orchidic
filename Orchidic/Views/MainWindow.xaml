<Window x:Class="Orchidic.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewModels="clr-namespace:Orchidic.ViewModels"
        xmlns:views="clr-namespace:Orchidic.Views"
        xmlns:components="clr-namespace:Orchidic.Views.Components"
        xmlns:reactiveUi="http://reactiveui.net"
        xmlns:utils="clr-namespace:Orchidic.Utils"
        mc:Ignorable="d"
        Width="1200" Height="800"
        MinWidth="900" MinHeight="600"
        WindowStartupLocation="CenterScreen"
        d:DataContext="{d:DesignInstance Type=viewModels:MainWindowViewModel}"
        SnapsToDevicePixels="True"
        WindowStyle="None"
        Background="Transparent"
        Title="{x:Static utils:ProgramConstants.AppName}">

  <Window.Resources>
    <views:MenuWidthConverter x:Key="MenuWidthConverter" />
    <views:BlurCoverSizeConverter x:Key="BlurCoverSizeConverter" />
  </Window.Resources>

  <WindowChrome.WindowChrome>
    <WindowChrome CaptionHeight="80"
                  CornerRadius="0"
                  GlassFrameThickness="0,0,0,0"
                  ResizeBorderThickness="6"
                  UseAeroCaptionButtons="False"
                  NonClientFrameEdges="None" />
  </WindowChrome.WindowChrome>


  <Grid
    Background="{DynamicResource BGBrush}"
    x:Name="RootParent"
    Margin="{Binding WindowState, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource StateToMargin}}">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="Auto" />
      <ColumnDefinition Width="*" />
    </Grid.ColumnDefinitions>

    <!-- blur cover -->
    <Grid Grid.Column="0" ColumnSpan="2" Grid.Row="0" RowSpan="2" ClipToBounds="False">
      <Image
        Source="{Binding Cover}"
        Stretch="UniformToFill"
        SnapsToDevicePixels="True"
        UseLayoutRounding="True"
        ClipToBounds="False"
        RenderOptions.BitmapScalingMode="LowQuality"
        HorizontalAlignment="Center"
        VerticalAlignment="Center"
        Opacity="{DynamicResource BlurCoverOpacity}">
        <Image.Height>
          <MultiBinding Converter="{StaticResource BlurCoverSizeConverter}">
            <Binding Path="ActualWidth" ElementName="RootParent" />
            <Binding Path="ActualHeight" ElementName="RootParent" />
          </MultiBinding>
        </Image.Height>
        <Image.Width>
          <MultiBinding Converter="{StaticResource BlurCoverSizeConverter}">
            <Binding Path="ActualWidth" ElementName="RootParent" />
            <Binding Path="ActualHeight" ElementName="RootParent" />
          </MultiBinding>
        </Image.Width>
        
      </Image>
    </Grid>

    <!-- content -->
    <Grid Grid.Row="0" Grid.Column="1" Grid.RowSpan="2">
      <reactiveUi:TransitioningContentControl
        HorizontalContentAlignment="Stretch"
        VerticalContentAlignment="Stretch"
        Content="{Binding CurrentPageViewModel, Converter={StaticResource ViewModelToViewConverter}}"
        Transition="Fade"
        Duration="0:0:0.150" />
    </Grid>


    <!-- title bar -->
    <Grid Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Height="50"
          Background="Transparent">
      <StackPanel FlowDirection="RightToLeft" Orientation="Horizontal">
        <Grid Height="50" Width="30" Margin="8,0,0,0">
          <Button Style="{StaticResource WindowCloseButton}" Click="CloseButton_OnClick" />
        </Grid>
        <Grid Height="50" Width="30">
          <Button Style="{StaticResource WindowControlButton}" Click="MaxButton_OnClick" />
        </Grid>
        <Grid Height="50" Width="30">
          <Button Style="{StaticResource WindowControlButton}" Click="MinButton_OnClick" />
        </Grid>
      </StackPanel>
    </Grid>

    <!-- left menu bar -->
    <Grid Grid.Row="0" Grid.Column="0" Grid.RowSpan="2"
          Background="{DynamicResource MenuBGBrush}"
          Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource MenuWidthConverter}}">

      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <!-- title -->
        <Grid Height="100">
          <TextBlock FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center"
                     Foreground="{DynamicResource TitleBrush}" FontWeight="Bold"
                     Text="{x:Static utils:ProgramConstants.AppName}" />
        </Grid>

        <!-- menu -->
        <components:SideMenu Grid.Row="1" DataContext="{Binding SideMenuViewModel}"></components:SideMenu>
      </Grid>
    </Grid>
  </Grid>
</Window>