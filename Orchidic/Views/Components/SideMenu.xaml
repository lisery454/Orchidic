<UserControl x:Class="Orchidic.Views.Components.SideMenu"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Orchidic.Views.Components"
             xmlns:viewModels="clr-namespace:Orchidic.ViewModels.Components"
             xmlns:utils="clr-namespace:Orchidic.Utils"
             d:DataContext="{d:DesignInstance Type=viewModels:SideMenuViewModel}"
             mc:Ignorable="d"
             d:DesignHeight="300" d:DesignWidth="300">
  <UserControl.Resources>
    <QuadraticEase x:Key="QuadraticEaseInOut" EasingMode="EaseInOut" />
  </UserControl.Resources>
  <Canvas
    Width="{Binding Width, RelativeSource={RelativeSource AncestorType=local:SideMenu}}"
    Height="{Binding Height, RelativeSource={RelativeSource AncestorType=local:SideMenu}}">
    <!-- 指示条 -->
    <Border
      Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Canvas}}"
      Height="60"
      Canvas.Left="0"
      Canvas.Top="0"
      local:SmoothCanvasBehavior.Top="{Binding SelectIndex, Converter={x:Static local:SideMenu.IndexToOffsetConverterIns}}"
      Background="{DynamicResource MenuItemIndicatorBrush}">
    </Border>

    <!-- 菜单列表 -->
    <ListBox ItemsSource="{Binding  SideMenuItems}"
             SelectedItem="{Binding PageType}"
             Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Canvas}}"
             BorderThickness="0"
             Background="Transparent"
             ScrollViewer.VerticalScrollBarVisibility="Disabled"
             SelectionMode="Single"
             FocusVisualStyle="{x:Null}">

      <ListBox.ItemContainerStyle>
        <Style TargetType="ListBoxItem">
          <Setter Property="Background" Value="Transparent" />
          <Setter Property="Cursor" Value="Hand" />
          <Setter Property="Height" Value="60" />
          <Setter Property="HorizontalContentAlignment" Value="Stretch" />
          <Setter Property="Template">
            <Setter.Value>
              <ControlTemplate TargetType="ListBoxItem">
                <Border x:Name="RootBorder" Background="{TemplateBinding Background}">
                  <Grid Cursor="Hand" Height="60">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="30" />
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="40" />
                    </Grid.ColumnDefinitions>

                    <utils:SuperellipseBorder Grid.Column="1" Height="36" Width="36"
                                              Power="4" CornerRadius="18">
                      <utils:SuperellipseBorder.Fill>
                        <SolidColorBrush x:Name="BorderBrush"
                                         Color="{DynamicResource SecondaryColor}" />
                      </utils:SuperellipseBorder.Fill>
                    </utils:SuperellipseBorder>

                    <TextBlock Grid.Column="2"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               FontSize="16"
                               Text="{Binding Path='.', Converter={StaticResource PageTitleConverter}}" />
                  </Grid>

                  <!-- ✅ VisualStateManager 管理动画 -->
                  <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup x:Name="SelectionStates">
                      <!-- 默认状态 -->
                      <VisualState x:Name="Normal">
                        <Storyboard>
                          <ColorAnimation Storyboard.TargetName="BorderBrush"
                                          Storyboard.TargetProperty="Color"
                                          To="{DynamicResource SecondaryColor}"
                                          Duration="0:0:0.15"
                                          EasingFunction="{StaticResource QuadraticEaseInOut}" />
                        </Storyboard>
                      </VisualState>
                      <!-- 鼠标悬浮 -->
                      <VisualState x:Name="MouseOver" />
                      <!-- ✅ 选中状态 -->
                      <VisualState x:Name="Selected">
                        <Storyboard>
                          <ColorAnimation Storyboard.TargetName="BorderBrush"
                                          Storyboard.TargetProperty="Color"
                                          To="{DynamicResource PrimaryColor}"
                                          Duration="0:0:0.15"
                                          EasingFunction="{StaticResource QuadraticEaseInOut}" />
                        </Storyboard>
                      </VisualState>
                    </VisualStateGroup>
                  </VisualStateManager.VisualStateGroups>
                </Border>


              </ControlTemplate>
            </Setter.Value>
          </Setter>
        </Style>
      </ListBox.ItemContainerStyle>
    </ListBox>
  </Canvas>
</UserControl>